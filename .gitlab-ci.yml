# Test meshpy.
meshpy-testing:
    script:
        - "whoami"
        - "pwd"
        - MESHPY_PATH=$(pwd)
        # Update the cubitpy repository.
        - cd $CUBITPY_MASTER
        - git pull
        - cd $MESHPY_PATH
        # Add python paths.
        - export PYTHONPATH="${PYTHONPATH}:$(pwd)"
        - export PYTHONPATH="${PYTHONPATH}:${CUBITPY_MASTER}"
        # Compile cython code.
        - "cd meshpy"
        - "python3 find_close_nodes_setup.py"
        - "cd .."
        # Run tests.
        - "cd tests"
        - "python3 testing_main.py"
    variables:
        # Indicated the testing script, that it is performed on GitLab. In this
        # case all test have to pass.
        TESTING_GITLAB: 1
        
        # Some test require baci-release to check if the created input file
        # works with baci.
        BACI_RELEASE: "/hdd/gitlab-runner/lib/baci-master/release/baci-release"
        
        # Meshpy can interact with cubitpy, to perform the corresponding tests,
        # the foloowing paths have to be set.
        CUBITPY_MASTER: "/hdd/gitlab-runner/lib/cubitpy-master"
        BACI_PRE_EXODUS: "/hdd/gitlab-runner/lib/baci-master/release/pre_exodus"
        CUBIT: "/rzhome/nas/compsim/public/opt/cubit-13.2"
    tags:
        - "imcs-all"
